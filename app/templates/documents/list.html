{% extends "base.html" %}

{% block title %}Documents - VocabExt{% endblock %}

{% block content %}
<h1>Documents</h1>

<article>
    <header>Upload Document</header>
    <form action="/documents/upload" method="post" enctype="multipart/form-data">
        <fieldset role="group">
            <input type="file" name="file" accept="{{ supported_extensions | join(',') }}" required>
            <button type="submit">Upload</button>
        </fieldset>
        <small>Supported: {{ supported_extensions | join(', ') }}</small>
    </form>
</article>

{% if documents %}
<table>
    <thead>
        <tr>
            <th>Filename</th>
            <th>Status</th>
            <th>Pending</th>
            <th>Duplicates</th>
            <th>Uploaded</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for doc in documents %}
        <tr>
            <td>{{ doc.filename }}</td>
            <td>
                {% if doc.status == 'processing' %}
                <span class="status-badge processing"
                      hx-get="/documents/{{ doc.id }}/status"
                      hx-trigger="every 3s"
                      hx-swap="outerHTML">
                    Processing...
                </span>
                {% elif doc.status == 'pending_review' %}
                <span class="status-badge pending">Pending Review</span>
                {% elif doc.status == 'reviewed' %}
                <span class="status-badge reviewed">Reviewed</span>
                {% elif doc.status == 'error' %}
                <span class="status-badge error" title="{{ doc.error_message }}">Error</span>
                {% endif %}
            </td>
            <td>{{ doc.pending_count }}</td>
            <td>{{ doc.duplicate_count }}</td>
            <td>{{ doc.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>
                <a href="/documents/{{ doc.id }}" role="button" class="outline">Review</a>
                <button type="button" class="outline secondary"
                        hx-delete="/documents/{{ doc.id }}"
                        hx-confirm="Delete this document and all its extractions?"
                        hx-target="closest tr"
                        hx-swap="delete swap:0.5s">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No documents uploaded yet. Upload a document to get started.</p>
{% endif %}
{% endblock %}
